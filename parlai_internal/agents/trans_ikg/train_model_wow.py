from parlai_internal.scripts.train_model import TrainModel

if __name__ == '__main__':
    TrainModel.main(
        task='wizard_of_wikipedia:generator',
        evaltask='wizard_of_wikipedia:generator:random_split,wizard_of_wikipedia:generator:topic_split',
        model='internal:trans_ikg',
        model_file='./outputs/TransIKG_wow/model',
        dict_lower=True,
        dict_tokenizer='bpe',
        variant='bart',
        activation='gelu',
        n_layers=5,
        n_heads=4,
        dropout=0.20,
        relu_dropout=0.20,
        attention_dropout=0.20,
        ffn_size=512,
        embedding_size=256,
        log_every_n_steps=500,
        validation_patience=6,
        # validation_patience=20,
        validation_metric='ppl',
        validation_metric_mode='min',
        validation_every_n_epochs=1,
        save_after_valid=True,
        n_positions=128,
        truncate=128,
        max_knowledge=32,
        knowledge_alpha=1.0,
        knowledge_truncate=32,
        learningrate=5e-4,
        warmup_updates=5000,
        learn_positional_embeddings=True,
        auxiliary_loss=True,
        fusion_attn='mlp',
        history_size=8,
        clip=0.1,
        betas='0.9,0.98',
        optimizer='adam',
        lr_scheduler='invsqrt',
        embedding_type='fasttext',
        metrics='all',
        skip_generation=False,
        batchsize=32,
        inference='beam',
        beam_size=2,
        beam_block_ngram=3,
        gpu=0,
        label_smoothing=True,
        use_dialogue_position=True,
        use_correlation_integration=True,
        use_overall_integration=True,
        use_copy=True,
        add_missing_turns='all',
    )
